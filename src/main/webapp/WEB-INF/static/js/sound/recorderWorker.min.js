function init(e){sampleRate=e.sampleRate}function record(e){recBuffersL.push(e[0]),recBuffersR.push(e[1]),recLength+=e[0].length}function exportWAV(e){var t=mergeBuffers(recBuffersL,recLength),r=mergeBuffers(recBuffersR,recLength),n=interleave(t,r),a=encodeWAV(n),f=new Blob([a],{type:e});this.postMessage(f)}function exportPCM(e){var t=mergeBuffers(recBuffersL,recLength),r=mergeBuffers(recBuffersR,recLength),n=interleave(t,r),a=encodeSpeex(n),f=new Blob([a],{type:e});this.postMessage(f)}function exportMonoWAV(e){var t=mergeBuffers(recBuffersL,recLength),r=encodeWAV(t,!0),n=new Blob([r],{type:e});this.postMessage(n)}function getBuffers(){var e=[];e.push(mergeBuffers(recBuffersL,recLength)),e.push(mergeBuffers(recBuffersR,recLength)),this.postMessage(e)}function clear(){recLength=0,recBuffersL=[],recBuffersR=[]}function mergeBuffers(e,t){for(var r=new Float32Array(t),n=0,a=0;a<e.length;a++)r.set(e[a],n),n+=e[a].length;return r}function interleave(e,t){for(var r=44100/bdSampleRate,n=e.length/r,a=new Float32Array(n),f=0,s=0;n>f;)a[f++]=e[parseInt(s)],s+=r;return a}function floatTo16BitPCM(e,t,r){for(var n=0;n<r.length;n++,t+=2){var a=Math.max(-1,Math.min(1,r[n]));e.setInt16(t,0>a?32768*a:32767*a,!0)}}function writeString(e,t,r){for(var n=0;n<r.length;n++)e.setUint8(t+n,r.charCodeAt(n))}function encodeWAV(e,t){var r=16,n=bdSampleRate,a=1,f=new ArrayBuffer(44+2*e.length),s=new DataView(f);return writeString(s,0,"RIFF"),s.setUint32(4,36+2*e.length,!0),writeString(s,8,"WAVE"),writeString(s,12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,a,!0),s.setUint32(24,n,!0),s.setUint32(28,n*a*(r/8),!0),s.setUint16(32,a*(r/8),!0),s.setUint16(34,r,!0),writeString(s,36,"data"),s.setUint32(40,2*e.length,!0),floatTo16BitPCM(s,44,e),s}function encodeSpeex(e){var t=new ArrayBuffer(2*e.length),r=new DataView(t);return floatTo16BitPCM(r,0,e),r}var recLength=0,recBuffersL=[],recBuffersR=[],sampleRate,bdSampleRate=16e3;this.onmessage=function(e){switch(e.data.command){case"init":init(e.data.config);break;case"record":record(e.data.buffer);break;case"exportWAV":exportWAV(e.data.type);break;case"exportPCM":exportPCM(e.data.type);break;case"exportMonoWAV":exportMonoWAV(e.data.type);break;case"getBuffers":getBuffers();break;case"clear":clear()}};
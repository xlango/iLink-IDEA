!function(t){var e="recorderWorker.min.js";document.write("<script language='JavaScript' src='speex.min.js'></script>");var o=function(t,o){var n=this,a=o||{},c=a.bufferLen||4096;this.emptydatacount=0,this.emptyCheckCount=0,this.context=t.context,this.context.createScriptProcessor?this.node=this.context.createScriptProcessor(c,2,2):this.node=this.context.createJavaScriptNode(c,2,2);var r=new Worker(a.workerPath||e);r.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var s,i=!1;this.node.onaudioprocess=function(t){i&&(n.isEmptyData(t.inputBuffer.getChannelData(0)),r.postMessage({command:"record",buffer:[t.inputBuffer.getChannelData(0),t.inputBuffer.getChannelData(1)]}))},this.configure=function(t){for(var e in t)t.hasOwnProperty(e)&&(a[e]=t[e])},this.record=function(){i=!0},this.stop=function(){i=!1},this.clear=function(){r.postMessage({command:"clear"})},this.getBuffers=function(t){s=t||a.callback,r.postMessage({command:"getBuffers"})},this.exportWAV=function(t,e){if(s=t||a.callback,e=e||a.type||"audio/wav",!s)throw new Error("Callback not set");r.postMessage({command:"exportWAV",type:e})},this.exportPCM=function(t,e){if(s=t||a.callback,e=e||a.type||"audio/pcm",!s)throw new Error("Callback not set");r.postMessage({command:"exportPCM",type:e})},this.setCallBack=function(t){s=t},this.exportMonoWAV=function(t,e){if(s=t||a.callback,e=e||a.type||"audio/wav",!s)throw new Error("Callback not set");r.postMessage({command:"exportMonoWAV",type:e})},this.isEmptyData=function(t){for(var e=Math.floor(t.length/10),o=0,a=0;e>a;a++)o+=Math.abs(t[10*a]);if(n.emptyCheckCount++,console.log(0+n.emptydatacount),10>o){if(n.emptydatacount++,n.emptydatacount>30)return s(),console.log("stoped"),n.emptydatacount=0,!0}else n.emptydatacount=0;return!1},r.onmessage=function(t){var e=t.data;s(e)},t.connect(this.node),this.node.connect(this.context.destination)};o.setupDownload=function(e,o){var n=(t.URL||t.webkitURL).createObjectURL(e),a=document.getElementById("save");a.href=n,a.download=o||"output.wav"},t.Recorder=o}(window);